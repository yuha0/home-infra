apiVersion: kubegres.reactive-tech.io/v1
kind: Kubegres
metadata:
  name: db
spec:
  replicas: 3
  image: postgres:14.3
  port: 5432
  database:
    size: 10Gi
    storageClassName: nfs-client
  securityContext:
    runAsNonRoot: true
    runAsUser: 999
    fsGroup: 999
  customConfig: db-init
  resources:
    limits:
      memory: 300Mi
      cpu: 300m
    requests:
      memory: 300Mi
      cpu: 300m
  env:
  - name: POSTGRES_PASSWORD
    valueFrom:
     secretKeyRef:
       name: db-admin
       key: POSTGRES_PASSWORD
  - name: POSTGRES_REPLICATION_PASSWORD
    valueFrom:
     secretKeyRef:
       name: db-admin
       key: POSTGRES_REPLICATION_PASSWORD
  - name: CUSTOM_DB_NAME
    value: metabase
  - name: CUSTOM_DB_USER
    value: metabase
  - name: CUSTOM_DB_PASSWORD
    valueFrom:
      secretKeyRef:
        name: db-user
        key: CUSTOM_DB_PASSWORD
