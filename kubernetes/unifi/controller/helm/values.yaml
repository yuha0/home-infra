#
# IMPORTANT NOTE
#
# This chart inherits from our common library chart. You can check the default values/options here:
# https://github.com/k8s-at-home/library-charts/tree/main/charts/stable/common/values.yaml
#

image:
  # -- image repository
  repository: jacobalberty/unifi
  # -- image tag
  tag: v6.4.54
  # -- image pull policy
  pullPolicy: IfNotPresent

podSecurityContext:
  runAsUser: 999
  runAsGroup: 999
  fsGroup: 999

nodeSelector:

resources:
  requests:
    memory: 3Gi

initContainers:
  config-init:
    image: jacobalberty/unifi:v6.4.54
    command:
    - /bin/bash
    - -c
    - >-
      mkdir -p /unifi/data/ && cp /tmp/unifi/config.gateway.json /unifi/data/config.gateway.json
    volumeMounts:
    - name: unifi-data
      mountPath: /unifi/
    - name: unifi-config
      mountPath: /tmp/unifi
  permission-fix:
    image: jacobalberty/unifi:v6.4.54
    command:
    - /bin/bash
    - -c
    - >-
      cp -r /usr/lib/unifi/* /tmp/usr-lib-unifi/ && chown -R unifi:unifi /tmp/usr-lib-unifi/
    volumeMounts:
    - name: usr-lib-unifi
      mountPath: /tmp/usr-lib-unifi/
    securityContext:
      runAsUser: 0

# -- environment variables. See more environment variables in the [image documentation](https://github.com/jacobalberty/unifi-docker#environment-variables).
# @default -- See below
env:
  # -- Set the container timezone
  TZ: UTC
  # -- Run UniFi as root
  RUNAS_UID0: "false"
  # -- Specify the user ID the application will run as
  UNIFI_UID: "999"
  # -- Specify the group ID the application will run as
  UNIFI_GID: "999"
  # -- Java Virtual Machine (JVM) initial, and minimum, heap size
  # Unset value means there is no lower limit
  JVM_INIT_HEAP_SIZE:
  # -- Java Virtual Machine (JVM) maximum heap size
  # For larger installations a larger value is recommended.
  # For memory constrained system this value can be lowered.
  JVM_MAX_HEAP_SIZE: 2048M
  # # -- External MongoDB URI
  DB_URI: mongodb://unifi-mongodb.unifi.svc.cluster.local.:27017/unifi
  STATDB_URI: mongodb://unifi-mongodb.unifi.svc.cluster.local.:27017/unifi_stat
  DB_NAME: unifi

# -- Configures service settings for the chart.
# @default -- See values.yaml
service:
  main:
    ports:
      # -- Configure Web interface + API port
      # @default -- See values.yaml
      http:
        port: 8443
        protocol: HTTPS
      # -- Configure Controller port used for device command/control
      # @default -- See values.yaml
      controller:
        enabled: true
        port: 8080
        protocol: TCP
      # -- Configure Captive Portal HTTP port
      # @default -- See values.yaml
      portal-http:
        enabled: true
        port: 8880
        protocol: HTTP
      # -- Configure Captive Portal HTTPS port
      # @default -- See values.yaml
      portal-https:
        enabled: true
        port: 8843
        protocol: HTTPS
      # -- Configure Speedtest port (used for UniFi mobile speed test)
      # @default -- See values.yaml
      speedtest:
        enabled: true
        port: 6789
        protocol: TCP
      # -- Configure STUN port
      # @default -- See values.yaml
      stun:
        enabled: true
        port: 3478
        protocol: UDP
      # -- Configure remote syslog port
      # @default -- See values.yaml
      syslog:
        enabled: true
        port: 5514
        protocol: UDP
      # -- Configure device discovery port
      # @default -- See values.yaml
      discovery:
        enabled: true
        port: 10001
        protocol: UDP

ingress:
  # -- Enable and configure ingress settings for the chart under this key.
  # @default -- See values.yaml
  main:
    enabled: true
    ingressClassName: nginx-internal
    annotations:
      nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
      nginx.ingress.kubernetes.io/proxy-ssl-verify: "off"
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    hosts:
    - host: "unifi.internal.yuha0.com"
      paths:
      - path: /

  # -- Enable and configure settings for the captive portal ingress under this key.
  # @default -- See values.yaml
  portal:
    enabled: true
    annotations:
      nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
      nginx.ingress.kubernetes.io/proxy-ssl-verify: "off"
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    hosts:
      - host: guest.yuha0.com
        ## Configure the paths for the host
        paths:
        - path: /

# -- Configure persistence settings for the chart under this key.
# @default -- See values.yaml
persistence:
  unifi-data:
    enabled: true
    mountPath: /unifi
    accessMode: ReadWriteMany
    size: 1Gi
    storageClass: nfs-client
  unifi-config:
    enabled: true
    type: custom
    mountPath: /tmp/unifi
    volumeSpec:
      configMap:
        name: unifi-config
  usr-lib-unifi:
    enabled: true
    type: custom
    mountPath: /usr/lib/unifi
    volumeSpec:
      emptyDir: {}
  var-run-unifi:
    enabled: true
    type: custom
    mountPath: /var/run/unifi
    volumeSpec:
      emptyDir: {}
    
  # data:
  #   enabled: true
  #   mountPath: /unifi
  #   accessMode: ReadWriteMany
  #   size: 10Gi
  #   storageClass: "nfs-client"

# -- Enable and configure mongodb database subchart under this key.
#    For more options see [mongodb chart documentation](https://github.com/bitnami/charts/tree/master/bitnami/mongodb)
# @default -- See values.yaml
mongodb:
  enabled: false
